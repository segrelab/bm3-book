
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Interface Basics &#8212; Becoming a Microbiome Metabolic Modeler</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Vivarium" href="Vivarium_intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/bu_microbiome_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Becoming a Microbiome Metabolic Modeler</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../setup.html">
   Set-Up
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ed_yong.html">
   Get Excited!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ecology
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ecology/cavaliere_summary.html">
   Cooperation in Microbial Communities and their Biotechnological Application
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Mathematical Optimization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../optimization/fundamentals.html">
   Fundamentals
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../optimization/core_concepts.html">
     Core Concepts and Definitions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../optimization/convex_analysis.html">
     Convex Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../optimization/linear_programming.html">
   Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../optimization/graphical_solution.html">
     Graphical Solution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../optimization/numerical_solution.html">
     Numerical Solution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../optimization/code_solution.html">
     Simplex Algorithm from Scratch in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../optimization/duality.html">
     Duality Theory
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Flux Balance Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../fba/what_is_fba.html">
   What is FBA?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fba/fba-units.html">
   A Note about FBA Units
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../fba/fba_from_scratch.html">
   FBA from scratch
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../fba/elementary_example.html">
     FBA from Scratch: Elementary Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../fba/intermediate_example.html">
     Intermediate Example
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Necessary Software &amp; Tools
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Vivarium_intro.html">
   Vivarium
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Interface Basics
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/hgscott/bm3-book/main?urlpath=tree/docs/software_and_tools/vivarium/Vivarium_interface_basics.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/hgscott/bm3-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/hgscott/bm3-book/issues/new?title=Issue%20on%20page%20%2Fsoftware_and_tools/vivarium/Vivarium_interface_basics.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/software_and_tools/vivarium/Vivarium_interface_basics.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-a-process-minimal-transcription">
   <strong>
    1. Make a Process: minimal transcription
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vivarium-s-basic-elements">
   Vivarium’s basic elements
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#process-interface-protocol">
     Process interface protocol
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#constructor">
     Constructor
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ports-schema">
     Ports Schema
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#advanced-ports-schema">
       Advanced ports_schema
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Advanced ports_schema
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initial-state">
     Initial State
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-method">
     Update Method
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tx-a-deterministic-transcription-process">
   Tx: a deterministic transcription process
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-tx-topology">
     plot Tx topology
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-tx">
     run Tx
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tl-a-deterministic-translation-process">
   Tl: a deterministic translation process
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-tl">
     run Tl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-a-composite">
   <strong>
    2. Make a Composite
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#txtl-a-transcription-translation-composite">
   TxTl: a transcription/translation composite
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#composition-protocol">
     Composition protocol
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#composite-constructor">
       composite constructor
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#generate-topology">
       generate topology
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#advanced-generate-topology">
       advanced generate topology
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#txtl-composer">
     TxTl Composer
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-txtl-topology">
     plot TxTl topology
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-txtl">
     run TxTl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-complexity">
   <strong>
    3. Adding Complexity
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stochastictx-a-stochastic-transcription-process">
   StochasticTx: a stochastic transcription process
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-variable-timesteps">
     plot variable timesteps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#auxiliary-processes">
   Auxiliary Processes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combining-stochastic-tx-with-deterministic-tl">
   Combining stochastic Tx with deterministic Tl
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-stochastictxtl-topology">
     plot StochasticTxTl topology
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-stochastictxtl">
     run StochasticTxTl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#growth-and-division">
   <strong>
    4. Growth and Division
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hierarchical-embedding">
   Hierarchical Embedding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hierarchy-updates">
   Hierarchy updates
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#colony-level-processes">
   Colony-level processes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-composite-merge-to-combine-colony-processes-with-agents">
     use composite.merge to combine colony processes with agents
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-hierarchy-topology-with-before-division">
     plot hierarchy topology with before division
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-hierarchy-topology-after-division">
     plot hierarchy topology after division
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-hierarchy-experiment">
     run hierarchy experiment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#colony-level-metrics">
     Colony-level metrics
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Interface Basics</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-a-process-minimal-transcription">
   <strong>
    1. Make a Process: minimal transcription
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vivarium-s-basic-elements">
   Vivarium’s basic elements
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#process-interface-protocol">
     Process interface protocol
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#constructor">
     Constructor
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ports-schema">
     Ports Schema
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#advanced-ports-schema">
       Advanced ports_schema
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Advanced ports_schema
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initial-state">
     Initial State
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-method">
     Update Method
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tx-a-deterministic-transcription-process">
   Tx: a deterministic transcription process
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-tx-topology">
     plot Tx topology
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-tx">
     run Tx
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tl-a-deterministic-translation-process">
   Tl: a deterministic translation process
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-tl">
     run Tl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-a-composite">
   <strong>
    2. Make a Composite
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#txtl-a-transcription-translation-composite">
   TxTl: a transcription/translation composite
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#composition-protocol">
     Composition protocol
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#composite-constructor">
       composite constructor
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#generate-topology">
       generate topology
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#advanced-generate-topology">
       advanced generate topology
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#txtl-composer">
     TxTl Composer
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-txtl-topology">
     plot TxTl topology
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-txtl">
     run TxTl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-complexity">
   <strong>
    3. Adding Complexity
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stochastictx-a-stochastic-transcription-process">
   StochasticTx: a stochastic transcription process
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-variable-timesteps">
     plot variable timesteps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#auxiliary-processes">
   Auxiliary Processes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combining-stochastic-tx-with-deterministic-tl">
   Combining stochastic Tx with deterministic Tl
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-stochastictxtl-topology">
     plot StochasticTxTl topology
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-stochastictxtl">
     run StochasticTxTl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#growth-and-division">
   <strong>
    4. Growth and Division
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hierarchical-embedding">
   Hierarchical Embedding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hierarchy-updates">
   Hierarchy updates
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#colony-level-processes">
   Colony-level processes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-composite-merge-to-combine-colony-processes-with-agents">
     use composite.merge to combine colony processes with agents
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-hierarchy-topology-with-before-division">
     plot hierarchy topology with before division
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-hierarchy-topology-after-division">
     plot hierarchy topology after division
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-hierarchy-experiment">
     run hierarchy experiment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#colony-level-metrics">
     Colony-level metrics
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="interface-basics">
<h1>Interface Basics<a class="headerlink" href="#interface-basics" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#uncomment to install vivarium-core</span>
<span class="c1">#!pip install vivarium-core</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports and Notebook Utilities</span>
<span class="c1"># import os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="c1"># import pylab as plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="c1"># Process, Deriver, and Composer base classes</span>
<span class="kn">from</span> <span class="nn">vivarium.core.process</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Deriver</span>
<span class="kn">from</span> <span class="nn">vivarium.core.composer</span> <span class="kn">import</span> <span class="n">Composer</span>
<span class="kn">from</span> <span class="nn">vivarium.core.registry</span> <span class="kn">import</span> <span class="n">process_registry</span>

<span class="c1"># helper functions for composition</span>
<span class="kn">from</span> <span class="nn">vivarium.core.composition</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">simulate_process</span><span class="p">,</span>
    <span class="n">process_in_experiment</span><span class="p">,</span>
    <span class="n">composer_in_experiment</span><span class="p">,</span>
    <span class="n">composite_in_experiment</span><span class="p">)</span>

<span class="c1"># other vivarium imports</span>
<span class="kn">from</span> <span class="nn">vivarium.core.engine</span> <span class="kn">import</span> <span class="n">Engine</span><span class="p">,</span> <span class="n">pp</span>
<span class="kn">from</span> <span class="nn">vivarium.library.units</span> <span class="kn">import</span> <span class="n">units</span>

<span class="c1"># plotting functions</span>
<span class="kn">from</span> <span class="nn">vivarium.plots.simulation_output</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">plot_simulation_output</span><span class="p">,</span> <span class="n">plot_variables</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">vivarium.plots.simulation_output</span> <span class="kn">import</span> <span class="n">_save_fig_to_dir</span> <span class="k">as</span> <span class="n">save_fig_to_dir</span>
<span class="kn">from</span> <span class="nn">vivarium.plots.agents_multigen</span> <span class="kn">import</span> <span class="n">plot_agents_multigen</span>
<span class="kn">from</span> <span class="nn">vivarium.plots.topology</span> <span class="kn">import</span> <span class="n">plot_topology</span>

<span class="n">AVOGADRO</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">N_A</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mol</span>

<span class="n">store_cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Dark2&#39;</span><span class="p">)</span>
<span class="n">dna_color</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">store_cmap</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">rna_color</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">store_cmap</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">protein_color</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">store_cmap</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">global_color</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">store_cmap</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<span class="n">store_colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="n">dna_color</span><span class="p">,</span>
    <span class="s1">&#39;DNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">:</span> <span class="n">dna_color</span><span class="p">,</span>
    <span class="s1">&#39;DNA</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">:</span> <span class="n">dna_color</span><span class="p">,</span>
    <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="n">rna_color</span><span class="p">,</span>
    <span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">:</span> <span class="n">rna_color</span><span class="p">,</span>
    <span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">:</span> <span class="n">rna_color</span><span class="p">,</span>
    <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="n">protein_color</span><span class="p">,</span>
    <span class="s1">&#39;Protein</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">:</span> <span class="n">protein_color</span><span class="p">,</span>
    <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="n">global_color</span><span class="p">}</span>

<span class="c1"># plotting configurations</span>
<span class="n">topology_plot_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;settings&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;Tx&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;node_distance&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="s1">&#39;process_color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="s1">&#39;store_colors&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">,</span>
        <span class="s1">&#39;dashed_edges&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;graph_format&#39;</span><span class="p">:</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color_edges&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;out/&#39;</span><span class="p">}</span>

<span class="n">plot_var_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;row_height&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;row_padding&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="s1">&#39;column_width&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;out&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<section id="make-a-process-minimal-transcription">
<h2><strong>1. Make a Process: minimal transcription</strong><a class="headerlink" href="#make-a-process-minimal-transcription" title="Permalink to this headline">#</a></h2>
<p>Transcription is the biological process by which RNA is synthesized from a DNA template.
Here, we define a model with a single mRNA species, <span class="math notranslate nohighlight">\(C\)</span>, transcribed from a single gene, <span class="math notranslate nohighlight">\(G\)</span>, at transcription rate <span class="math notranslate nohighlight">\(k_{tsc}\)</span>.
RNA also degrades at rate <span class="math notranslate nohighlight">\(k_{deg}\)</span>.</p>
<p>This can be represented by a chemical reaction network with the form:</p>
<br>
<center>
$Gene_{G} \xrightarrow[]{k_{tsc}} Gene_{G} + RNA_{C} $ <br><br>
$RNA_{C} \xrightarrow[]{k_{deg}} \emptyset$
</center>
<p>Which is written as the difference equation:</p>
<br>
<center>
$\Delta RNA_{C} = (k_{tsc}[Gene_{G}] - k_{deg}[RNA_{C}]) \Delta t $ <br>
</center></section>
<section id="vivarium-s-basic-elements">
<h2>Vivarium’s basic elements<a class="headerlink" href="#vivarium-s-basic-elements" title="Permalink to this headline">#</a></h2>
<p><strong>Processes</strong> can implement any kind of dynamical model - dynamic flux balance analysis, differential equation, stochastic process, Boolean logic, etc. <br />
<strong>Stores</strong> are databases of state variables read by the Processes, with methods for applying each Processes’ updates.</p>
<table><tr>
<td> <img src="https://github.com/vivarium-collective/vivarium-notebooks/blob/main/notebooks/images/process.png?raw=1" alt="Drawing" style="width: 400;"/> </td>
<td> <img src="https://github.com/vivarium-collective/vivarium-notebooks/blob/main/notebooks/images/store.png?raw=1" alt="Drawing" style="width: 400;"/> </td>
</tr></table><section id="process-interface-protocol">
<h3>Process interface protocol<a class="headerlink" href="#process-interface-protocol" title="Permalink to this headline">#</a></h3>
<p>If standard modeling formats are an “HTML” for systems biology, we need an “interface protocol” such as TCP/IP serves for the internet – a protocol for connecting separate systems into a complex and open-ended network that anyone can contribute to.</p>
<p>Making a dynamical model into a Vivarium Process requires the following protocol:</p>
<ol class="simple">
<li><p>A <em>constructor</em> that accepts parameters and configures the model.</p></li>
<li><p>A <em>ports_schema</em> that declares the ports and their schema.</p></li>
<li><p>A <em>next_update</em> that runs the model and returns an update.</p></li>
</ol>
</section>
<section id="constructor">
<h3>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code> parameters are used in absense of an other provided parameters.</p></li>
<li><p>The constructor’s <code class="docutils literal notranslate"><span class="pre">parameters</span></code> arguments overrides the <code class="docutils literal notranslate"><span class="pre">default</span></code> parameters.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Tx</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
 
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ktsc&#39;</span><span class="p">:</span> <span class="mf">1e-2</span><span class="p">,</span>
        <span class="s1">&#39;kdeg&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="ports-schema">
<h3>Ports Schema<a class="headerlink" href="#ports-schema" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Ports are the connections by which Process are wired to Stores.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ports_schema</span></code> declares the ports, the variables that go through them, and how those variables operate.</p></li>
<li><p>Here, <code class="docutils literal notranslate"><span class="pre">Tx</span></code> declares a port for <code class="docutils literal notranslate"><span class="pre">mRNA</span></code> with variable <code class="docutils literal notranslate"><span class="pre">C</span></code>, and a port for <code class="docutils literal notranslate"><span class="pre">DNA</span></code> with variable <code class="docutils literal notranslate"><span class="pre">G</span></code>.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ports_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s1">&#39;_updater&#39;</span><span class="p">:</span> <span class="s1">&#39;accumulate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;_divider&#39;</span><span class="p">:</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span>
                <span class="s1">&#39;_properties&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;mw&#39;</span><span class="p">:</span> <span class="mf">111.1</span> <span class="n">units</span><span class="o">.</span><span class="n">g</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mol</span><span class="p">}},</span>
        <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">{</span>  
            <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}}</span>
</pre></div>
</div>
<section id="advanced-ports-schema">
<h4>Advanced ports_schema<a class="headerlink" href="#advanced-ports-schema" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>dictionary comprehensions are useful for declaring schema for configured variables.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ports_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">molecule_schema</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;_emit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;molecules&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">mol_id</span><span class="p">:</span> <span class="n">molecule_schema</span> 
            <span class="k">for</span> <span class="n">mol_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;molecules&#39;</span><span class="p">]}}</span>
</pre></div>
</div>
</section>
<section id="id1">
<h4>Advanced ports_schema<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Schema methods can also be declared by passing in functions.</p></li>
<li><p>The asymmetric_division divider makes molecules in the ‘front’ go to one daughter cell upon division, and those in the ‘back’ go to the other daughter.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">asymmetric_division</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">topology</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;front&#39;</span> <span class="ow">in</span> <span class="n">topology</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s1">&#39;back&#39;</span> <span class="ow">in</span> <span class="n">topology</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">ports_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;front&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;molecule&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;_divider&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;divider&#39;</span><span class="p">:</span> <span class="n">asymmetric_division</span><span class="p">,</span>
                    <span class="s1">&#39;topology&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;front&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;molecule&#39;</span><span class="p">,)},</span>
                <span class="p">}}},</span>
        <span class="s1">&#39;back&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;molecule&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;_divider&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;divider&#39;</span><span class="p">:</span> <span class="n">asymmetric_division</span><span class="p">,</span>
                    <span class="s1">&#39;topology&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;back&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;molecule&#39;</span><span class="p">,)},</span>
                <span class="p">}}}}</span>
</pre></div>
</div>
</section>
</section>
<section id="initial-state">
<h3>Initial State<a class="headerlink" href="#initial-state" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Each Process MAY provide an <code class="docutils literal notranslate"><span class="pre">initial_state</span></code> method. This can be retrieved, reconfigured, and passed into a simulation.</p></li>
<li><p>If left empty, a simulation initializes at the <code class="docutils literal notranslate"><span class="pre">'_default'</span></code> values.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}}</span>
</pre></div>
</div>
</section>
<section id="update-method">
<h3>Update Method<a class="headerlink" href="#update-method" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>Retrieve</strong> the state variables through the ports.</p></li>
<li><p><strong>Run</strong> the model for the timestep’s duration.</p></li>
<li><p><strong>Return</strong> an update to the state variable through the ports.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">timestep</span><span class="p">):</span>

    <span class="c1"># Retrieve</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;DNA&#39;</span><span class="p">][</span><span class="s1">&#39;G&#39;</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">][</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>

    <span class="c1"># Run</span>
    <span class="n">dC</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ktsc</span> <span class="o">*</span> <span class="n">G</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">kdeg</span> <span class="o">*</span> <span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">timestep</span>

    <span class="c1"># Return</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">dC</span><span class="p">}}</span>
</pre></div>
</div>
</section>
</section>
<section id="tx-a-deterministic-transcription-process">
<h2>Tx: a deterministic transcription process<a class="headerlink" href="#tx-a-deterministic-transcription-process" title="Permalink to this headline">#</a></h2>
<p>According to <a class="reference external" href="https://bionumbers.hms.harvard.edu/bionumber.aspx?s=n&amp;v=3&amp;id=100043">BioNumbers</a>, the concentration of DNA in an <em>E. coli</em> cell is on the order of 11-18 mg/mL. The concentration of RNA is 75-120 mg/ml.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Tx</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ktsc&#39;</span><span class="p">:</span> <span class="mf">1e-2</span><span class="p">,</span>
        <span class="s1">&#39;kdeg&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">ports_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">{</span>  
                <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">,</span>         
                    <span class="s1">&#39;_updater&#39;</span><span class="p">:</span> <span class="s1">&#39;accumulate&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_emit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">,</span>
                    <span class="s1">&#39;_updater&#39;</span><span class="p">:</span> <span class="s1">&#39;accumulate&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_emit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}}</span>
    
    <span class="k">def</span> <span class="nf">next_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;DNA&#39;</span><span class="p">][</span><span class="s1">&#39;G&#39;</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">][</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="n">dC</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;ktsc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">G</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;kdeg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">timestep</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">dC</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<section id="plot-tx-topology">
<h3>plot Tx topology<a class="headerlink" href="#plot-tx-topology" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_topology</span><span class="p">(</span><span class="n">Tx</span><span class="p">(),</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;tx_topology.pdf&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">topology_plot_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing out/tx_topology.pdf
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_16_1.png" src="../../_images/Vivarium_interface_basics_16_1.png" />
</div>
</div>
</section>
<section id="run-tx">
<h3>run Tx<a class="headerlink" href="#run-tx" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tsc configuration</span>
<span class="n">tx_config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="n">tx_sim_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;experiment_id&#39;</span><span class="p">:</span> <span class="s1">&#39;TX&#39;</span><span class="p">}</span>
<span class="n">tx_initial_state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span><span class="o">/</span><span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">}}</span>
<span class="n">tx_plot_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">]</span>
        <span class="p">},</span> 
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DNA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;DNA&#39;</span><span class="p">]</span>
        <span class="p">}],</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;tx_output.pdf&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">plot_var_config</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize</span>
<span class="n">tx_process</span> <span class="o">=</span> <span class="n">Tx</span><span class="p">(</span><span class="n">tx_config</span><span class="p">)</span>

<span class="c1"># make the experiment</span>
<span class="n">tx_exp</span> <span class="o">=</span> <span class="n">process_in_experiment</span><span class="p">(</span>
    <span class="n">tx_process</span><span class="p">,</span> <span class="n">tx_sim_settings</span><span class="p">,</span> <span class="n">tx_initial_state</span><span class="p">)</span>

<span class="c1"># run</span>
<span class="n">tx_exp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="c1"># retrieve the data as a timeseries</span>
<span class="n">tx_output</span> <span class="o">=</span> <span class="n">tx_exp</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">get_timeseries</span><span class="p">()</span>

<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_variables</span><span class="p">(</span><span class="n">tx_output</span><span class="p">,</span>  <span class="o">**</span><span class="n">tx_plot_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Simulation ID: TX
Created: 09/13/2022 at 17:37:02
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed in 0.103842 seconds
Writing out/tx_output.pdf
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_19_2.png" src="../../_images/Vivarium_interface_basics_19_2.png" />
</div>
</div>
</section>
</section>
<section id="tl-a-deterministic-translation-process">
<h2>Tl: a deterministic translation process<a class="headerlink" href="#tl-a-deterministic-translation-process" title="Permalink to this headline">#</a></h2>
<p>Translation is the biological process by which protein is synthesized with an mRNA template.
Here, we define a model with a single protein species, <span class="math notranslate nohighlight">\(Protein_{X}\)</span>, transcribed from a single gene, <span class="math notranslate nohighlight">\(RNA_{C}\)</span>, at translation rate <span class="math notranslate nohighlight">\(k_{trl}\)</span>.
Protein also degrades at rate <span class="math notranslate nohighlight">\(k_{deg}\)</span>.</p>
<p>This can be represented by a chemical reaction network with the form:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(RNA_{C} \xrightarrow[]{k_{trl}} RNA_{C} + Protein_{X} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(Protein_{X} \xrightarrow[]{k_{deg}} \emptyset\)</span></p></li>
</ul>
<p>According to <a class="reference external" href="https://bionumbers.hms.harvard.edu/bionumber.aspx?s=n&amp;v=3&amp;id=100043">BioNumbers</a>, the concentration of RNA in an <em>E. coli</em> cell is on the order of 75-120 mg/ml. The concentration of protein is 200-320 mg/ml.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Tl</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>

    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ktrl&#39;</span><span class="p">:</span> <span class="mf">5e-4</span><span class="p">,</span>
        <span class="s1">&#39;kdeg&#39;</span><span class="p">:</span> <span class="mf">5e-5</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">ports_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">,</span>
                    <span class="s1">&#39;_divider&#39;</span><span class="p">:</span> <span class="s1">&#39;split&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_emit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
            <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mi">200</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">,</span>
                    <span class="s1">&#39;_divider&#39;</span><span class="p">:</span> <span class="s1">&#39;split&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_emit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}}</span>

    <span class="k">def</span> <span class="nf">next_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">][</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;Protein&#39;</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
        <span class="n">dX</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;ktrl&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;kdeg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="n">timestep</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">dX</span><span class="p">}}</span>
    
</pre></div>
</div>
</div>
</div>
<section id="run-tl">
<h3>run Tl<a class="headerlink" href="#run-tl" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># trl configuration</span>
<span class="n">tl_config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="n">tl_sim_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;experiment_id&#39;</span><span class="p">:</span> <span class="s1">&#39;TL&#39;</span><span class="p">}</span>
<span class="n">tl_initial_state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">}}</span>
<span class="n">tl_plot_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;Protein&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">]</span>
        <span class="p">},</span>  
        <span class="p">],</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;tl_output.pdf&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">plot_var_config</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize</span>
<span class="n">tl_process</span> <span class="o">=</span> <span class="n">Tl</span><span class="p">(</span><span class="n">tl_config</span><span class="p">)</span>

<span class="c1"># make the experiment</span>
<span class="n">tl_exp</span> <span class="o">=</span> <span class="n">process_in_experiment</span><span class="p">(</span>
    <span class="n">tl_process</span><span class="p">,</span> <span class="n">tl_sim_settings</span><span class="p">,</span> <span class="n">tl_initial_state</span><span class="p">)</span>

<span class="c1"># run</span>
<span class="n">tl_exp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="c1"># retrieve the data as a timeseries</span>
<span class="n">tl_output</span> <span class="o">=</span> <span class="n">tl_exp</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">get_timeseries</span><span class="p">()</span>

<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_variables</span><span class="p">(</span><span class="n">tl_output</span><span class="p">,</span>  <span class="o">**</span><span class="n">tl_plot_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Simulation ID: TL
Created: 09/13/2022 at 17:37:02
Completed in 0.102436 seconds
Writing out/tl_output.pdf
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_24_1.png" src="../../_images/Vivarium_interface_basics_24_1.png" />
</div>
</div>
</section>
</section>
<section id="make-a-composite">
<h2><strong>2. Make a Composite</strong><a class="headerlink" href="#make-a-composite" title="Permalink to this headline">#</a></h2>
<p>A <strong>Composite</strong> is a set of Processes and Stores. Vivarium constructs the Stores from the Processes’s port_schema methods and wires them up as instructed by a <strong>Topology</strong>. The only communication between Processes is through variables in shared Stores.</p>
<center><img src="https://github.com/vivarium-collective/vivarium-notebooks/blob/main/notebooks/images/composite.png?raw=1" width=400/></center></section>
<section id="txtl-a-transcription-translation-composite">
<h2>TxTl: a transcription/translation composite<a class="headerlink" href="#txtl-a-transcription-translation-composite" title="Permalink to this headline">#</a></h2>
<p>We demonstrate composition by combining the <code class="docutils literal notranslate"><span class="pre">Tx</span></code> and <code class="docutils literal notranslate"><span class="pre">Tl</span></code> processes.</p>
<section id="composition-protocol">
<h3>Composition protocol<a class="headerlink" href="#composition-protocol" title="Permalink to this headline">#</a></h3>
<p>Composers, which combine processes into composites are implemented with the protocol:</p>
<ol class="simple">
<li><p>A <em>constructor</em> that accepts configuration data, which can override the consituent Processes’ default parameters.</p></li>
<li><p>A <em>generate_processes</em> method that constructs the Processes, passing model parameters as needed.</p></li>
<li><p>A <em>generate_topology</em> method that returns the Topology definition which tells Vivarium how to wire up the Processes to Stores.</p></li>
</ol>
<section id="composite-constructor">
<h4>composite constructor<a class="headerlink" href="#composite-constructor" title="Permalink to this headline">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TxTl</span><span class="p">(</span><span class="n">Composer</span><span class="p">):</span>
    
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Tx&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ktsc&#39;</span><span class="p">:</span> <span class="mf">1e-2</span><span class="p">},</span>
        <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ktrl&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">}}</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="generate-topology">
<h4>generate topology<a class="headerlink" href="#generate-topology" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Here, <code class="docutils literal notranslate"><span class="pre">generate_topology()</span></code> returns the Topology definition that wires these Processes together with 3 Stores, one of them shared.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;Tx&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DNA&#39;</span><span class="p">,),</span>     <span class="c1"># connect TSC&#39;s &#39;DNA&#39; Port to a &#39;DNA&#39; Store</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA&#39;</span><span class="p">,)},</span>  <span class="c1"># connect TSC&#39;s &#39;mRNA&#39; Port to a &#39;mRNA&#39; Store</span>
        <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA&#39;</span><span class="p">,),</span>   <span class="c1"># connect TRL&#39;s &#39;mRNA&#39; Port to the same &#39;mRNA&#39; Store</span>
            <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">,)}}</span>
</pre></div>
</div>
</section>
<section id="advanced-generate-topology">
<h4>advanced generate topology<a class="headerlink" href="#advanced-generate-topology" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p><strong>embedding in a hierarchy</strong>: to connect to sub-stores in a hierarchy, declare the path through each substore, as done to ‘lipids’.</p>
<ul>
<li><p>To connect to supra-stores use <code class="docutils literal notranslate"><span class="pre">'..'</span></code> for each level up, as done to <code class="docutils literal notranslate"><span class="pre">'external'</span></code>.</p></li>
</ul>
</li>
<li><p><strong>splitting ports</strong>: One port can connect to multiple stores by specifying the path for each variable, as is done to <code class="docutils literal notranslate"><span class="pre">'transport'</span></code>.</p>
<ul>
<li><p>This can be used to re-map variable names, for integration of different models.</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_topology</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;process_1&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;lipids&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;organelle&#39;</span><span class="p">,</span> <span class="s1">&#39;membrane&#39;</span><span class="p">,</span> <span class="s1">&#39;lipid&#39;</span><span class="p">),</span>
            <span class="s1">&#39;external&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;environment&#39;</span><span class="p">),</span>
            <span class="s1">&#39;transport&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;glucose_external&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;external&#39;</span><span class="p">,</span> <span class="s1">&#39;glucose&#39;</span><span class="p">),</span>
                <span class="s1">&#39;glucose_internal&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;glucose&#39;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">}}</span>
</pre></div>
</div>
</section>
</section>
<section id="txtl-composer">
<h3>TxTl Composer<a class="headerlink" href="#txtl-composer" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TxTl</span><span class="p">(</span><span class="n">Composer</span><span class="p">):</span>
    
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Tx&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
        <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}}</span>

    <span class="k">def</span> <span class="nf">generate_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;Tx&#39;</span><span class="p">:</span> <span class="n">Tx</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Tx&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="n">Tl</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Tl&#39;</span><span class="p">])}</span>

    <span class="k">def</span> <span class="nf">generate_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;Tx&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DNA&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA&#39;</span><span class="p">,)},</span>
            <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">,)}}</span>
    
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-txtl-topology">
<h3>plot TxTl topology<a class="headerlink" href="#plot-txtl-topology" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">txtl_topology_plot_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">topology_plot_config</span><span class="p">)</span>
<span class="n">txtl_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_topology</span><span class="p">(</span><span class="n">TxTl</span><span class="p">(),</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;txtl_topology.pdf&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">topology_plot_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing out/txtl_topology.pdf
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_34_1.png" src="../../_images/Vivarium_interface_basics_34_1.png" />
</div>
</div>
</section>
<section id="run-txtl">
<h3>run TxTl<a class="headerlink" href="#run-txtl" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tsc_trl configuration</span>
<span class="n">txtl_config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">txtl_exp_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;experiment_id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXTL&#39;</span><span class="p">}</span>
<span class="n">txtl_plot_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;variables&#39;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;Protein&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DNA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span> 
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;DNA&#39;</span><span class="p">]</span>
        <span class="p">},</span>
    <span class="p">],</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;txtl_output.pdf&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">plot_var_config</span><span class="p">}</span>
<span class="n">tl_initial_state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">},</span>
    <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># construct TxTl</span>
<span class="n">txtl_composite</span> <span class="o">=</span> <span class="n">TxTl</span><span class="p">(</span><span class="n">txtl_config</span><span class="p">)</span>

<span class="c1"># make the experiment</span>
<span class="n">txtl_experiment</span> <span class="o">=</span> <span class="n">composer_in_experiment</span><span class="p">(</span>
    <span class="n">txtl_composite</span><span class="p">,</span> <span class="n">txtl_exp_settings</span><span class="p">,</span> <span class="n">tl_initial_state</span><span class="p">)</span>

<span class="c1"># run it and retrieve the data that was emitted to the simulation log</span>
<span class="n">txtl_experiment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span>
<span class="n">txtl_output</span> <span class="o">=</span> <span class="n">txtl_experiment</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">get_timeseries</span><span class="p">()</span>

<span class="c1"># plot the output</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_variables</span><span class="p">(</span><span class="n">txtl_output</span><span class="p">,</span> <span class="o">**</span><span class="n">txtl_plot_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Simulation ID: TXTL
Created: 09/13/2022 at 17:37:03
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed in 0.351073 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing out/txtl_output.pdf
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_37_3.png" src="../../_images/Vivarium_interface_basics_37_3.png" />
</div>
</div>
</section>
</section>
<section id="adding-complexity">
<h2><strong>3. Adding Complexity</strong><a class="headerlink" href="#adding-complexity" title="Permalink to this headline">#</a></h2>
<p>Process modularity allows modelers to iterate on model design by swapping out different models.
We demonstrated this by replacing the deterministic Transcription Process with a Stochastic Transcription Process.</p>
<p>Stochastic transcription requires variable timesteps, which Vivarium accomodates with multi-timestepping.</p>
<center><img src="https://github.com/vivarium-collective/vivarium-notebooks/blob/main/notebooks/images/dynamics.png?raw=1" width=600/></center></section>
<section id="stochastictx-a-stochastic-transcription-process">
<h2>StochasticTx: a stochastic transcription process<a class="headerlink" href="#stochastictx-a-stochastic-transcription-process" title="Permalink to this headline">#</a></h2>
<p>This process uses the <a class="reference external" href="https://en.wikipedia.org/wiki/Gillespie_algorithm">Gillespie algorithm</a> in its <code class="docutils literal notranslate"><span class="pre">next_update()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stoch_exp_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;settings&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;experiment_id&#39;</span><span class="p">:</span> <span class="s1">&#39;stochastic_txtl&#39;</span><span class="p">},</span>
    <span class="s1">&#39;initial_state&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;DNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
            <span class="p">},</span>
            <span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.0</span>
            <span class="p">},</span>
            <span class="s1">&#39;Protein</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span>
            <span class="p">}}}</span>


<span class="n">stoch_plot_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;variables&#39;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Protein</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span> 
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;Protein&#39;</span><span class="p">],</span>
            <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;Protein: X (mg/mL)&#39;</span><span class="p">},</span> 
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;milligram / milliliter&#39;</span><span class="p">)),</span> 
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">],</span>
            <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;mRNA: C (mg/mL)&#39;</span><span class="p">},</span> 
        <span class="p">{</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">),</span> 
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">store_colors</span><span class="p">[</span><span class="s1">&#39;DNA&#39;</span><span class="p">],</span>
            <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;DNA: G (counts)&#39;</span><span class="p">},</span> 
    <span class="p">],</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;stochastic_txtl_output.pdf&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">plot_var_config</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StochasticTx</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>

    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ktsc&#39;</span><span class="p">:</span> <span class="mf">1e0</span><span class="p">,</span>
        <span class="s1">&#39;kdeg&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ktsc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;ktsc&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kdeg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;kdeg&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stoichiometry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_left</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># initialize the next timestep</span>
        <span class="n">initial_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_timestep</span><span class="p">(</span><span class="n">initial_state</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
            <span class="p">},</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
            <span class="p">}</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">ports_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s1">&#39;_emit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s1">&#39;_emit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}}</span>

    <span class="k">def</span> <span class="nf">calculate_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
        <span class="c1"># retrieve the state values</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;DNA&#39;</span><span class="p">][</span><span class="s1">&#39;G&#39;</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">][</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>

        <span class="n">array_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">g</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>

        <span class="c1"># Calculate propensities</span>
        <span class="n">propensities</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ktsc</span> <span class="o">*</span> <span class="n">array_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">kdeg</span> <span class="o">*</span> <span class="n">array_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">prop_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">propensities</span><span class="p">)</span>

        <span class="c1"># The wait time is distributed exponentially</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculated_timestep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">prop_sum</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculated_timestep</span>

    <span class="k">def</span> <span class="nf">next_reaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get the next reaction and return a new state&quot;&quot;&quot;</span>

        <span class="n">propensities</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ktsc</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">kdeg</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">prop_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">propensities</span><span class="p">)</span>

        <span class="c1"># Choose the next reaction</span>
        <span class="n">r_rxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">propensities</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">r_rxn</span> <span class="o">&lt;</span> <span class="n">propensities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">prop_sum</span><span class="p">:</span>
                <span class="c1"># This means propensity i fires</span>
                <span class="k">break</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichiometry</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">next_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timestep</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_left</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_left</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">event</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">time_left</span> <span class="o">-=</span> <span class="n">timestep</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># retrieve the state values, put them in array</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;DNA&#39;</span><span class="p">][</span><span class="s1">&#39;G&#39;</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s1">&#39;mRNA&#39;</span><span class="p">][</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="n">array_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">g</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>

        <span class="c1"># calculate the next reaction</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_reaction</span><span class="p">(</span><span class="n">array_state</span><span class="p">)</span>

        <span class="c1"># get delta mRNA</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">new_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d_c</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">c</span>

        <span class="n">update</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">d_c</span><span class="p">}}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculated_timestep</span> <span class="o">&gt;</span> <span class="n">timestep</span><span class="p">:</span>
            <span class="c1"># didn&#39;t get all of our time, store the event for later</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculated_timestep</span> <span class="o">-</span> <span class="n">timestep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">update</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># return an update</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">d_c</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<section id="plot-variable-timesteps">
<h3>plot variable timesteps<a class="headerlink" href="#plot-variable-timesteps" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stoch_tx_process</span> <span class="o">=</span> <span class="n">StochasticTx</span><span class="p">(</span><span class="n">tx_config</span><span class="p">)</span>
<span class="n">stoch_tx_exp</span> <span class="o">=</span> <span class="n">process_in_experiment</span><span class="p">(</span><span class="n">stoch_tx_process</span><span class="p">,</span> <span class="o">**</span><span class="n">stoch_exp_settings</span><span class="p">)</span>
<span class="n">stoch_tx_exp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">stoch_tx_output</span> <span class="o">=</span> <span class="n">stoch_tx_exp</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">get_timeseries</span><span class="p">()</span>



<span class="c1"># calculate the timesteps</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">stoch_tx_output</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<span class="n">timesteps</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">::],</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">::]):</span> 
<span class="c1">#     if y-x != 1.0:</span>
        <span class="n">timesteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> 
        
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;timestep (seconds)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;out/stochastic_timesteps.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Simulation ID: stochastic_txtl
Created: 09/13/2022 at 17:37:04
Completed in 0.140025 seconds
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_43_1.png" src="../../_images/Vivarium_interface_basics_43_1.png" />
</div>
</div>
</section>
</section>
<section id="auxiliary-processes">
<h2>Auxiliary Processes<a class="headerlink" href="#auxiliary-processes" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Connecting different Processes may require addition ‘helper’ Processes to make conversions and adapt their unique requirements different values.</p></li>
<li><p>Derivers are a subclass of Process that runs after the other dynamic Processes and derives some states from others.</p></li>
</ul>
<p>A <strong>concentration deriver</strong> convert the counts of the stochastic process to concentrations. This is available in the <code class="docutils literal notranslate"><span class="pre">process_registry</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">concentrations_deriver</span> <span class="o">=</span> <span class="n">process_registry</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;concentrations_deriver&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="combining-stochastic-tx-with-deterministic-tl">
<h2>Combining stochastic Tx with deterministic Tl<a class="headerlink" href="#combining-stochastic-tx-with-deterministic-tl" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># configuration data</span>
<span class="n">mw_config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">1e8</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">g</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mol</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>  
<span class="k">class</span> <span class="nc">StochasticTxTl</span><span class="p">(</span><span class="n">Composer</span><span class="p">):</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;stochastic_Tx&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="s1">&#39;concs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;molecular_weights&#39;</span><span class="p">:</span> <span class="n">mw_config</span><span class="p">}}</span>
    
    <span class="k">def</span> <span class="nf">generate_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">counts_to_concentration</span> <span class="o">=</span> <span class="n">process_registry</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counts_to_concentration&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;stochastic</span><span class="se">\n</span><span class="s1">Tx&#39;</span><span class="p">:</span> <span class="n">StochasticTx</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;stochastic_Tx&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="n">Tl</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Tl&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;counts</span><span class="se">\n</span><span class="s1">to</span><span class="se">\n</span><span class="s1">mg/mL&#39;</span><span class="p">:</span> <span class="n">counts_to_concentration</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;concs&#39;</span><span class="p">])}</span>

    <span class="k">def</span> <span class="nf">generate_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;stochastic</span><span class="se">\n</span><span class="s1">Tx&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">,)</span>
            <span class="p">},</span>
            <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Protein</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">,)</span>
            <span class="p">},</span>
            <span class="s1">&#39;counts</span><span class="se">\n</span><span class="s1">to</span><span class="se">\n</span><span class="s1">mg/mL&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">,)</span>
            <span class="p">}}</span>
    
</pre></div>
</div>
</div>
</div>
<section id="plot-stochastictxtl-topology">
<h3>plot StochasticTxTl topology<a class="headerlink" href="#plot-stochastictxtl-topology" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot topology after merge</span>
<span class="n">stochastic_topology_plot_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">topology_plot_config</span><span class="p">)</span>
<span class="n">stochastic_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;graph_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>
<span class="n">stochastic_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;stochastic</span><span class="se">\n</span><span class="s1">Tx&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;counts</span><span class="se">\n</span><span class="s1">to</span><span class="se">\n</span><span class="s1">mg/mL&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;DNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(counts)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;mRNA</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;Protein</span><span class="se">\n</span><span class="s1">(mg/mL)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)}</span>
<span class="n">stochastic_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;dashed_edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">stochastic_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;show_ports&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">stochastic_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.2</span>


<span class="n">stochastic_txtl</span> <span class="o">=</span> <span class="n">StochasticTxTl</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_topology</span><span class="p">(</span>
    <span class="n">stochastic_txtl</span><span class="p">,</span> 
    <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;stochastic_txtl_topology.pdf&#39;</span><span class="p">,</span> 
    <span class="o">**</span><span class="n">stochastic_topology_plot_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing out/stochastic_txtl_topology.pdf
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_49_1.png" src="../../_images/Vivarium_interface_basics_49_1.png" />
</div>
</div>
</section>
<section id="run-stochastictxtl">
<h3>run StochasticTxTl<a class="headerlink" href="#run-stochastictxtl" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make the experiment</span>
<span class="n">stoch_experiment</span> <span class="o">=</span> <span class="n">composer_in_experiment</span><span class="p">(</span><span class="n">stochastic_txtl</span><span class="p">,</span> <span class="o">**</span><span class="n">stoch_exp_settings</span><span class="p">)</span>

<span class="c1"># simulate and retrieve the data</span>
<span class="n">stoch_experiment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">stochastic_txtl_output</span> <span class="o">=</span> <span class="n">stoch_experiment</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">get_timeseries</span><span class="p">()</span>

<span class="c1"># plot output</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_variables</span><span class="p">(</span><span class="n">stochastic_txtl_output</span><span class="p">,</span> <span class="o">**</span><span class="n">stoch_plot_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Simulation ID: stochastic_txtl
Created: 09/13/2022 at 17:37:04
Completed in 0.316201 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing out/stochastic_txtl_output.pdf
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_51_2.png" src="../../_images/Vivarium_interface_basics_51_2.png" />
</div>
</div>
</section>
</section>
<section id="growth-and-division">
<h2><strong>4. Growth and Division</strong><a class="headerlink" href="#growth-and-division" title="Permalink to this headline">#</a></h2>
<p>We here extend the Transcription/Translation model with division. This require many instances of the processes to run simultaneously in a single simulation. To support such phenomena, Vivarium adopts an agent-based modeling bigraphical formalism, with embedded compartments that can spawn new compartments during runtime.</p>
<!-- <center><img src="images/tsc_trl_divide.png" width=700/></center> --></section>
<section id="hierarchical-embedding">
<h2>Hierarchical Embedding<a class="headerlink" href="#hierarchical-embedding" title="Permalink to this headline">#</a></h2>
<p>To support this requirement, Processes can be embedded in a hierarchical representation of embedded compartments.
Vivarium uses a bigraph formalism – a graph with embeddable nodes that can be placed within other nodes.</p>
<center><img src="https://github.com/vivarium-collective/vivarium-notebooks/blob/main/notebooks/images/embedding.png?raw=1" width=600/></center></section>
<section id="hierarchy-updates">
<h2>Hierarchy updates<a class="headerlink" href="#hierarchy-updates" title="Permalink to this headline">#</a></h2>
<p>The structure of a hierarchy has its own type of constructive dynamics with formation/destruction, merging/division, engulfing/expelling of compartments</p>
<center><img src="https://github.com/vivarium-collective/vivarium-notebooks/blob/main/notebooks/images/constructive.png?raw=1" width=600/></center><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add imported division processes</span>
<span class="kn">from</span> <span class="nn">vivarium.processes.divide_condition</span> <span class="kn">import</span> <span class="n">DivideCondition</span>
<span class="kn">from</span> <span class="nn">vivarium.processes.meta_division</span> <span class="kn">import</span> <span class="n">MetaDivision</span>
<span class="kn">from</span> <span class="nn">vivarium.processes.growth_rate</span> <span class="kn">import</span> <span class="n">GrowthRate</span>

<span class="n">TIMESTEP</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">class</span> <span class="nc">TxTlDivision</span><span class="p">(</span><span class="n">Composer</span><span class="p">):</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;stochastic_Tx&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="n">TIMESTEP</span><span class="p">},</span>
        <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="n">TIMESTEP</span><span class="p">},</span>
        <span class="s1">&#39;concs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;molecular_weights&#39;</span><span class="p">:</span> <span class="n">mw_config</span><span class="p">},</span>
        <span class="s1">&#39;growth&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;default_growth_rate&#39;</span><span class="p">:</span> <span class="mf">0.0005</span><span class="p">,</span>
            <span class="s1">&#39;default_growth_noise&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
            <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]},</span>
        <span class="s1">&#39;agent_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="s1">&#39;divide_condition&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">fL</span><span class="p">},</span>
        <span class="s1">&#39;agents_path&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;agents&#39;</span><span class="p">,),</span>
        <span class="s1">&#39;daughter_path&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(),</span>
        <span class="s1">&#39;_schema&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;concs&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;_divider&#39;</span><span class="p">:</span> <span class="s1">&#39;binomial&#39;</span><span class="p">}},</span>
                <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;_divider&#39;</span><span class="p">:</span> <span class="s1">&#39;set&#39;</span><span class="p">}},</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">generate_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">counts_to_concentration</span> <span class="o">=</span> <span class="n">process_registry</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counts_to_concentration&#39;</span><span class="p">)</span>
        <span class="n">division_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">daughter_path</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;daughter_path&#39;</span><span class="p">],</span>
            <span class="n">agent_id</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">],</span>
            <span class="n">composer</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;stochastic_Tx&#39;</span><span class="p">:</span> <span class="n">StochasticTx</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;stochastic_Tx&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="n">Tl</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Tl&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;concs&#39;</span><span class="p">:</span> <span class="n">counts_to_concentration</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;concs&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;growth&#39;</span><span class="p">:</span> <span class="n">GrowthRate</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;growth&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;divide_condition&#39;</span><span class="p">:</span> <span class="n">DivideCondition</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;divide_condition&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;division&#39;</span><span class="p">:</span> <span class="n">MetaDivision</span><span class="p">(</span><span class="n">division_config</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">generate_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;stochastic_Tx&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DNA&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;RNA_counts&#39;</span><span class="p">,)</span>
            <span class="p">},</span>
            <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mRNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;RNA&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">,)</span>
            <span class="p">},</span>
            <span class="s1">&#39;concs&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;RNA_counts&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;RNA&#39;</span><span class="p">,)</span>
            <span class="p">},</span>
            <span class="s1">&#39;growth&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;rates&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;rates&#39;</span><span class="p">,)</span>
            <span class="p">},</span>
            <span class="s1">&#39;divide_condition&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;divide&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;divide&#39;</span><span class="p">,)},</span>
            <span class="s1">&#39;division&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;agents&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;agents_path&#39;</span><span class="p">]}</span>
        <span class="p">}</span>

  
</pre></div>
</div>
</div>
</div>
</section>
<section id="colony-level-processes">
<h2>Colony-level processes<a class="headerlink" href="#colony-level-processes" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">vivarium.library.units</span> <span class="kn">import</span> <span class="n">Quantity</span>

<span class="k">def</span> <span class="nf">calculate_volume</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="n">units</span><span class="o">.</span><span class="n">fL</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    
<span class="k">class</span> <span class="nc">ColonyVolume</span><span class="p">(</span><span class="n">Deriver</span><span class="p">):</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;colony_path&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;agents&#39;</span><span class="p">)}</span>
    <span class="k">def</span> <span class="nf">ports_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;colony&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;_default&#39;</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">fL</span><span class="p">,</span>
                    <span class="s1">&#39;_updater&#39;</span><span class="p">:</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_emit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}}</span>
    <span class="k">def</span> <span class="nf">next_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;colony&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;_reduce&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;reducer&#39;</span><span class="p">:</span> <span class="n">calculate_volume</span><span class="p">,</span>
                        <span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;colony_path&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">fL</span><span class="p">}}}}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># configure hierarchy</span>
<span class="c1"># agent config</span>
<span class="n">agent_id</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
<span class="n">agent_config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;agent_id&#39;</span><span class="p">:</span> <span class="n">agent_id</span><span class="p">}</span>

<span class="c1"># environment config</span>
<span class="n">env_config</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># initial state</span>
<span class="n">hierarchy_initial_state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;agents&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">agent_id</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">fL</span><span class="p">},</span>
            <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s1">&#39;RNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">},</span>
            <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">}}}}</span>

<span class="c1"># experiment settings</span>
<span class="n">exp_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;experiment_id&#39;</span><span class="p">:</span> <span class="s1">&#39;hierarchy_experiment&#39;</span><span class="p">,</span>
    <span class="s1">&#39;initial_state&#39;</span><span class="p">:</span> <span class="n">hierarchy_initial_state</span><span class="p">,</span>
    <span class="s1">&#39;emit_step&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">}</span>

<span class="c1"># plot config</span>
<span class="n">hierarchy_plot_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;include_paths&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;RNA_counts&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;RNA&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;DNA&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s1">&#39;store_order&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">,</span> <span class="s1">&#39;RNA_counts&#39;</span><span class="p">,</span> <span class="s1">&#39;DNA&#39;</span><span class="p">,</span> <span class="s1">&#39;RNA&#39;</span><span class="p">),</span>
    <span class="s1">&#39;titles_map&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Protein&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,):</span> <span class="s1">&#39;Protein&#39;</span><span class="p">,</span> 
        <span class="p">(</span><span class="s1">&#39;RNA_counts&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">):</span> <span class="s1">&#39;RNA&#39;</span><span class="p">,</span> 
        <span class="p">(</span><span class="s1">&#39;DNA&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,):</span> <span class="s1">&#39;DNA&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;RNA&#39;</span><span class="p">:</span> <span class="s1">&#39;RNA&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;column_width&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s1">&#39;row_height&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;stack_column&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;tick_label_size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;title_size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>

<span class="n">colony_plot_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;femtoliter&#39;</span><span class="p">))],</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;colony_growth.pdf&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">plot_var_config</span><span class="p">}</span>


<span class="c1"># hierarchy topology plot</span>
<span class="n">agent_0_string</span> <span class="o">=</span> <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0&#39;</span>
<span class="n">agent_1_string</span> <span class="o">=</span> <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">00&#39;</span>
<span class="n">agent_2_string</span> <span class="o">=</span> <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">01&#39;</span>
<span class="n">row_1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">row_2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">row_3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">row_4</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
<span class="n">node_space</span> <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">vertical_space</span><span class="o">=</span><span class="mf">0.9</span>
<span class="n">bump</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">process_column</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>
<span class="n">agent_row</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.2</span>
<span class="n">agent_column</span> <span class="o">=</span> <span class="n">bump</span><span class="o">/</span><span class="mi">2</span> <span class="c1">#0.5</span>

<span class="n">hierarchy_topology_plot_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;settings&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;graph_format&#39;</span><span class="p">:</span> <span class="s1">&#39;hierarchy&#39;</span><span class="p">,</span>
        <span class="s1">&#39;node_size&#39;</span><span class="p">:</span> <span class="mi">6000</span><span class="p">,</span>
        <span class="s1">&#39;process_color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="s1">&#39;store_color&#39;</span><span class="p">:</span> <span class="n">global_color</span><span class="p">,</span>
        <span class="s1">&#39;store_colors&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">agent_0_string</span><span class="si">}</span><span class="se">\n</span><span class="s1">DNA&#39;</span><span class="p">:</span> <span class="n">dna_color</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">agent_0_string</span><span class="si">}</span><span class="se">\n</span><span class="s1">RNA&#39;</span><span class="p">:</span> <span class="n">rna_color</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">agent_0_string</span><span class="si">}</span><span class="se">\n</span><span class="s1">RNA_counts&#39;</span><span class="p">:</span> <span class="n">rna_color</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">agent_0_string</span><span class="si">}</span><span class="se">\n</span><span class="s1">Protein&#39;</span><span class="p">:</span> <span class="n">protein_color</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;dashed_edges&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;show_ports&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># Processes</span>
            <span class="s1">&#39;ColonyVolume&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">stochastic_Tx&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">agent_column</span><span class="p">,</span> <span class="n">agent_row</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">Tl&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">agent_column</span><span class="o">+</span><span class="n">node_space</span><span class="p">,</span> <span class="n">agent_row</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">concs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">agent_column</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">node_space</span><span class="p">,</span> <span class="n">agent_row</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">division&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">agent_column</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">node_space</span><span class="p">,</span> <span class="n">agent_row</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="c1"># Stores</span>
            <span class="s1">&#39;agents&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">node_space</span><span class="p">,</span> <span class="n">row_1</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">node_space</span><span class="p">,</span> <span class="n">row_2</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">agents&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">node_space</span><span class="p">,</span> <span class="n">row_1</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">DNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">row_3</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">RNA_counts&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">node_space</span><span class="o">+</span><span class="n">bump</span><span class="p">,</span> <span class="n">row_3</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">RNA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">node_space</span><span class="p">,</span> <span class="p">(</span><span class="n">row_3</span><span class="o">-</span><span class="n">bump</span><span class="p">)</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">Protein&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">node_space</span><span class="o">+</span><span class="n">bump</span><span class="p">,</span> <span class="n">row_3</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">global&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">node_space</span><span class="o">+</span><span class="n">bump</span><span class="p">,</span> <span class="n">row_3</span><span class="o">*</span><span class="n">vertical_space</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;node_labels&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># Processes</span>
            <span class="s1">&#39;ColonyVolume&#39;</span><span class="p">:</span> <span class="s1">&#39;Colony</span><span class="se">\n</span><span class="s1">Volume&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">stochastic_Tx&#39;</span><span class="p">:</span> <span class="s1">&#39;stochastic</span><span class="se">\n</span><span class="s1">Tx&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">Tl&#39;</span><span class="p">:</span> <span class="s1">&#39;Tl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">concs&#39;</span><span class="p">:</span> <span class="s1">&#39;counts</span><span class="se">\n</span><span class="s1">to</span><span class="se">\n</span><span class="s1">mg/mL&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">growth&#39;</span><span class="p">:</span> <span class="s1">&#39;growth&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">division&#39;</span><span class="p">:</span> <span class="s1">&#39;division&#39;</span><span class="p">,</span>
            <span class="c1"># Stores</span>
            <span class="c1"># third</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">DNA&#39;</span><span class="p">:</span> <span class="s1">&#39;DNA&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">RNA&#39;</span><span class="p">:</span> <span class="s1">&#39;RNA&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">rates&#39;</span><span class="p">:</span> <span class="s1">&#39;rates&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">RNA_counts&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">global&#39;</span><span class="p">:</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">Protein&#39;</span><span class="p">:</span> <span class="s1">&#39;Protein&#39;</span><span class="p">,</span>
            <span class="c1"># fourth</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">rates</span><span class="se">\n</span><span class="s1">growth_rate&#39;</span><span class="p">:</span> <span class="s1">&#39;growth_rate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">rates</span><span class="se">\n</span><span class="s1">growth_noise&#39;</span><span class="p">:</span> <span class="s1">&#39;growth_noise&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;remove_nodes&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">rates</span><span class="se">\n</span><span class="s1">growth_rate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">rates</span><span class="se">\n</span><span class="s1">growth_noise&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">rates&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">growth&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">divide_condition&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">global</span><span class="se">\n</span><span class="s1">divide&#39;</span><span class="p">,</span>
            <span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">0</span><span class="se">\n</span><span class="s1">global</span><span class="se">\n</span><span class="s1">volume&#39;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;out/&#39;</span>
<span class="p">}</span>

<span class="c1"># topology plot config for after division</span>
<span class="n">agent_2_dist</span> <span class="o">=</span> <span class="mf">3.5</span>
<span class="n">hierarchy_topology_plot_config2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">hierarchy_topology_plot_config</span><span class="p">)</span>

<span class="c1"># redo coordinates, labels, store_colors, and removal</span>
<span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;store_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># hierarchy_topology_plot_config2[&#39;settings&#39;][&#39;remove_nodes&#39;] = []</span>
<span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">hierarchy_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">agent_0_string</span> <span class="ow">in</span> <span class="n">node_id</span><span class="p">:</span>
        <span class="n">new_id1</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">agent_0_string</span><span class="p">,</span> <span class="n">agent_1_string</span><span class="p">)</span>
        <span class="n">new_id2</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">agent_0_string</span><span class="p">,</span> <span class="n">agent_2_string</span><span class="p">)</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="n">new_id1</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="n">new_id2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">agent_2_dist</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">agent_2_dist</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="s1">&#39;ColonyVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">hierarchy_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">agent_0_string</span> <span class="ow">in</span> <span class="n">node_id</span><span class="p">:</span>
        <span class="n">new_id1</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">agent_0_string</span><span class="p">,</span> <span class="n">agent_1_string</span><span class="p">)</span>
        <span class="n">new_id2</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">agent_0_string</span><span class="p">,</span> <span class="n">agent_2_string</span><span class="p">)</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_labels&#39;</span><span class="p">][</span><span class="n">new_id1</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_labels&#39;</span><span class="p">][</span><span class="n">new_id2</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_labels&#39;</span><span class="p">][</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
<span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_labels&#39;</span><span class="p">][</span><span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;node_labels&#39;</span><span class="p">][</span><span class="s1">&#39;agents</span><span class="se">\n</span><span class="s1">01&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>

<span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">hierarchy_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;store_colors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">agent_0_string</span> <span class="ow">in</span> <span class="n">node_id</span><span class="p">:</span>
        <span class="n">new_id1</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">agent_0_string</span><span class="p">,</span> <span class="n">agent_1_string</span><span class="p">)</span>
        <span class="n">new_id2</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">agent_0_string</span><span class="p">,</span> <span class="n">agent_2_string</span><span class="p">)</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;store_colors&#39;</span><span class="p">][</span><span class="n">new_id1</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;store_colors&#39;</span><span class="p">][</span><span class="n">new_id2</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;store_colors&#39;</span><span class="p">][</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
        
<span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">hierarchy_topology_plot_config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;remove_nodes&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">agent_0_string</span> <span class="ow">in</span> <span class="n">node_id</span><span class="p">:</span>
        <span class="n">new_id1</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">agent_0_string</span><span class="p">,</span> <span class="n">agent_1_string</span><span class="p">)</span>
        <span class="n">new_id2</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">agent_0_string</span><span class="p">,</span> <span class="n">agent_2_string</span><span class="p">)</span>
        <span class="n">hierarchy_topology_plot_config2</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;remove_nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">new_id1</span><span class="p">,</span> <span class="n">new_id2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="use-composite-merge-to-combine-colony-processes-with-agents">
<h3>use composite.merge to combine colony processes with agents<a class="headerlink" href="#use-composite-merge-to-combine-colony-processes-with-agents" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a txtl composite, embedded under an agents store</span>
<span class="n">txtl_composer</span> <span class="o">=</span> <span class="n">TxTlDivision</span><span class="p">(</span><span class="n">agent_config</span><span class="p">)</span>
<span class="n">hierarchy_composite</span> <span class="o">=</span> <span class="n">txtl_composer</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;agents&#39;</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">))</span>

<span class="c1"># make a colony composite, and a topology that connects its colony port to agents store</span>
<span class="n">colony_composer</span> <span class="o">=</span> <span class="n">ColonyVolume</span><span class="p">(</span><span class="n">env_config</span><span class="p">)</span>
<span class="n">colony_composite</span> <span class="o">=</span> <span class="n">colony_composer</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
<span class="n">colony_topology</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ColonyVolume&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;colony&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;agents&#39;</span><span class="p">,)}}</span>

<span class="c1"># perform merge</span>
<span class="n">hierarchy_composite</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">composite</span><span class="o">=</span><span class="n">colony_composite</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="n">colony_topology</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-hierarchy-topology-with-before-division">
<h3>plot hierarchy topology with before division<a class="headerlink" href="#plot-hierarchy-topology-with-before-division" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_topology</span><span class="p">(</span>
    <span class="n">hierarchy_composite</span><span class="p">,</span> 
    <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;hierarchy_topology.pdf&#39;</span><span class="p">,</span> 
    <span class="o">**</span><span class="n">hierarchy_topology_plot_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing out/hierarchy_topology.pdf
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/helenscott/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/core/store.py:520: UserWarning: Incompatible schema assignment at (&#39;agents&#39;, &#39;0&#39;, &#39;RNA&#39;, &#39;C&#39;). Trying to assign the value &lt;function divide_set at 0x11764dab0&gt; to key divider, which already has the value &lt;function divide_split at 0x11764dbd0&gt;.
  warnings.warn(
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_62_2.png" src="../../_images/Vivarium_interface_basics_62_2.png" />
</div>
</div>
</section>
<section id="plot-hierarchy-topology-after-division">
<h3>plot hierarchy topology after division<a class="headerlink" href="#plot-hierarchy-topology-after-division" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initial state</span>
<span class="n">initial_state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;agents&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">agent_id</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">fL</span><span class="p">},</span>
            <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s1">&#39;RNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">},</span>
            <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">}}}}</span>

<span class="c1"># make a copy of the composite</span>
<span class="n">txtl_composite1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">hierarchy_composite</span><span class="p">)</span>

<span class="c1"># make the experiment</span>
<span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">hierarchy_experiment1</span> <span class="o">=</span> <span class="n">composite_in_experiment</span><span class="p">(</span>
    <span class="n">composite</span><span class="o">=</span><span class="n">txtl_composite1</span><span class="p">,</span> 
    <span class="n">settings</span><span class="o">=</span><span class="n">exp_settings</span><span class="p">,</span> 
    <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">)</span>

<span class="c1"># run the experiment long enough to divide</span>
<span class="n">hierarchy_experiment1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Simulation ID: hierarchy_experiment
Created: 09/13/2022 at 17:37:05
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/helenscott/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/core/store.py:520: UserWarning: Incompatible schema assignment at (&#39;agents&#39;, &#39;00&#39;, &#39;RNA&#39;, &#39;C&#39;). Trying to assign the value &lt;function divide_set at 0x11764dab0&gt; to key divider, which already has the value &lt;function divide_split at 0x11764dbd0&gt;.
  warnings.warn(
/Users/helenscott/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/core/store.py:520: UserWarning: Incompatible schema assignment at (&#39;agents&#39;, &#39;01&#39;, &#39;RNA&#39;, &#39;C&#39;). Trying to assign the value &lt;function divide_set at 0x11764dab0&gt; to key divider, which already has the value &lt;function divide_split at 0x11764dbd0&gt;.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed in 1.67 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_topology</span><span class="p">(</span>
    <span class="n">txtl_composite1</span><span class="p">,</span> 
    <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;hierarchy_topology_2.pdf&#39;</span><span class="p">,</span> 
    <span class="o">**</span><span class="n">hierarchy_topology_plot_config2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_topology</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">txtl_composite1</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;hierarchy_topology_2.pdf&#39;</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="o">**</span><span class="n">hierarchy_topology_plot_config2</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/plots/topology.py:492,</span> in <span class="ni">plot_topology</span><span class="nt">(composite, settings, out_dir, filename)</span>
<span class="g g-Whitespace">    </span><span class="mi">490</span> <span class="c1"># make networkx graph</span>
<span class="g g-Whitespace">    </span><span class="mi">491</span> <span class="n">remove_nodes</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;remove_nodes&#39;</span><span class="p">,</span> <span class="p">[])</span>
<span class="ne">--&gt; </span><span class="mi">492</span> <span class="n">g</span><span class="p">,</span> <span class="n">place_edges</span> <span class="o">=</span> <span class="n">get_networkx_graph</span><span class="p">(</span><span class="n">composite</span><span class="p">,</span> <span class="n">remove_nodes</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">493</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;place_edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">place_edges</span>
<span class="g g-Whitespace">    </span><span class="mi">495</span> <span class="c1"># make graph figure</span>

<span class="nn">File ~/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/plots/topology.py:176,</span> in <span class="ni">get_networkx_graph</span><span class="nt">(composite, remove_nodes)</span>
<span class="g g-Whitespace">    </span><span class="mi">173</span> <span class="n">remove_nodes</span> <span class="o">=</span> <span class="n">remove_nodes</span> <span class="ow">or</span> <span class="p">[]</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span> <span class="c1"># get the nodes and edges from the composite</span>
<span class="ne">--&gt; </span><span class="mi">176</span> <span class="n">process_nodes</span><span class="p">,</span> <span class="n">store_nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">place_edges</span> <span class="o">=</span> <span class="n">get_bigraph</span><span class="p">(</span><span class="n">composite</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">178</span> <span class="c1"># remove specified nodes</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span> <span class="n">process_nodes</span> <span class="o">=</span> <span class="n">remove</span><span class="p">(</span><span class="n">remove_nodes</span><span class="p">,</span> <span class="n">node_list</span><span class="o">=</span><span class="n">process_nodes</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/plots/topology.py:64,</span> in <span class="ni">get_bigraph</span><span class="nt">(composite)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span> <span class="n">processes</span> <span class="o">=</span> <span class="n">composite</span><span class="p">[</span><span class="s1">&#39;processes&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span> <span class="n">steps</span> <span class="o">=</span> <span class="n">composite</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span>
<span class="ne">---&gt; </span><span class="mi">64</span> <span class="n">hierarchy_object</span> <span class="o">=</span> <span class="n">generate_state</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>     <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span>     <span class="n">topology</span><span class="o">=</span><span class="n">topology</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="n">initial_state</span><span class="o">=</span><span class="p">{},</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>     <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span> <span class="c1"># get path to processes and stores, name them by their paths</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="c1"># leaf_paths = hierarchy_object.depth(filter_function=lambda x: x.inner == {})</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span> <span class="n">process_paths</span> <span class="o">=</span> <span class="n">hierarchy_object</span><span class="o">.</span><span class="n">depth</span><span class="p">(</span><span class="n">filter_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Process</span><span class="p">))</span>

<span class="nn">File ~/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/core/store.py:49,</span> in <span class="ni">generate_state</span><span class="nt">(processes, topology, initial_state, steps, flow)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Store</span><span class="p">({})</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span> <span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span> <span class="ow">or</span> <span class="p">{}</span>
<span class="ne">---&gt; </span><span class="mi">49</span> <span class="n">store</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">processes</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">topology</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span> <span class="n">store</span><span class="o">.</span><span class="n">build_topology_views</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span> <span class="k">return</span> <span class="n">store</span>

<span class="nn">File ~/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/core/store.py:2000,</span> in <span class="ni">Store.generate</span><span class="nt">(self, path, processes, steps, flow, topology, initial_state)</span>
<span class="g g-Whitespace">   </span><span class="mi">1992</span> <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1993</span><span class="sd"> Generate a subtree of this store at the given path.</span>
<span class="g g-Whitespace">   </span><span class="mi">1994</span><span class="sd"> The processes will be mapped into locations in the tree by the</span>
<span class="g g-Whitespace">   </span><span class="mi">1995</span><span class="sd"> topology, and once everything is constructed the initial_state</span>
<span class="g g-Whitespace">   </span><span class="mi">1996</span><span class="sd"> will be applied.</span>
<span class="g g-Whitespace">   </span><span class="mi">1997</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1999</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_establish_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">{})</span>
<span class="ne">-&gt; </span><span class="mi">2000</span> <span class="n">target</span><span class="o">.</span><span class="n">_generate_paths</span><span class="p">(</span><span class="n">processes</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">topology</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2001</span> <span class="n">target</span><span class="o">.</span><span class="n">_generate_paths</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">topology</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2002</span> <span class="n">target</span><span class="o">.</span><span class="n">_apply_subschemas</span><span class="p">()</span>

<span class="nn">File ~/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/core/store.py:1975,</span> in <span class="ni">Store._generate_paths</span><span class="nt">(self, processes, flow, topology)</span>
<span class="g g-Whitespace">   </span><span class="mi">1973</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1974</span>     <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Store</span><span class="p">({},</span> <span class="n">outer</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1975</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_generate_paths</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1976</span>     <span class="n">subprocess</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1977</span>     <span class="n">subflow</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1978</span>     <span class="n">subtopology</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1979</span> <span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/bm3-book-dev/lib/python3.10/site-packages/vivarium/core/store.py:1951,</span> in <span class="ni">Store._generate_paths</span><span class="nt">(self, processes, flow, topology)</span>
<span class="g g-Whitespace">   </span><span class="mi">1929</span> <span class="sd">&quot;&quot;&quot;Set up state :term:`hierarchy` with stores.</span>
<span class="g g-Whitespace">   </span><span class="mi">1930</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1931</span><span class="sd"> Recursively creates the entire state hierarchy rooted at</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">1948</span><span class="sd">     topology: The topology.</span>
<span class="g g-Whitespace">   </span><span class="mi">1949</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1950</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">subprocess</span> <span class="ow">in</span> <span class="n">processes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="ne">-&gt; </span><span class="mi">1951</span>     <span class="n">subtopology</span> <span class="o">=</span> <span class="n">topology</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1952</span>     <span class="n">subflow</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">if</span> <span class="n">flow</span> <span class="k">else</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1953</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subprocess</span><span class="p">,</span> <span class="n">Process</span><span class="p">):</span>

<span class="ne">KeyError</span>: &#39;0&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-hierarchy-experiment">
<h3>run hierarchy experiment<a class="headerlink" href="#run-hierarchy-experiment" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initial state</span>
<span class="n">initial_state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;agents&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">agent_id</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">fL</span><span class="p">},</span>
            <span class="s1">&#39;DNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s1">&#39;RNA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">},</span>
            <span class="s1">&#39;Protein&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">mL</span><span class="p">}}}}</span>

<span class="c1"># make the experiment</span>
<span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">hierarchy_experiment</span> <span class="o">=</span> <span class="n">composite_in_experiment</span><span class="p">(</span>
    <span class="n">composite</span><span class="o">=</span><span class="n">hierarchy_composite</span><span class="p">,</span> 
    <span class="n">settings</span><span class="o">=</span><span class="n">exp_settings</span><span class="p">,</span> 
    <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">)</span>

<span class="c1"># run the experiment</span>
<span class="n">hierarchy_experiment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">6000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Simulation ID: hierarchy_experiment
Created: 08/26/2021 at 16:53:33
Completed in 129.27 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># retrieve the data</span>
<span class="n">hierarchy_data</span> <span class="o">=</span> <span class="n">hierarchy_experiment</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">get_data_unitless</span><span class="p">()</span>
<span class="n">path_ts</span> <span class="o">=</span> <span class="n">hierarchy_experiment</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">get_path_timeseries</span><span class="p">()</span>

<span class="c1"># add agent colors</span>
<span class="n">dimgray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">agent_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="s1">&#39;0&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">agent_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent_id</span><span class="p">:</span> <span class="n">dimgray</span> <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agent_ids</span><span class="p">}</span>
<span class="n">hierarchy_plot_settings</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;agent_colors&#39;</span><span class="p">:</span> <span class="n">agent_colors</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize the plot</span>
<span class="n">multigen_fig</span> <span class="o">=</span> <span class="n">plot_agents_multigen</span><span class="p">(</span><span class="n">hierarchy_data</span><span class="p">,</span> <span class="n">hierarchy_plot_settings</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="colony-level-metrics">
<h3>Colony-level metrics<a class="headerlink" href="#colony-level-metrics" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gd_timeseries</span> <span class="o">=</span> <span class="n">hierarchy_experiment</span><span class="o">.</span><span class="n">emitter</span><span class="o">.</span><span class="n">get_timeseries</span><span class="p">()</span>
<span class="n">colony_series</span> <span class="o">=</span> <span class="n">gd_timeseries</span><span class="p">[</span><span class="s1">&#39;agents&#39;</span><span class="p">][(</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;femtoliter&#39;</span><span class="p">)]</span>
<span class="n">time_vec</span> <span class="o">=</span> <span class="n">gd_timeseries</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the RNA_counts axis, to replace with colony volume</span>
<span class="n">allaxes</span> <span class="o">=</span> <span class="n">multigen_fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">allaxes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;RNA </span><span class="se">\n</span><span class="s1">C&#39;</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axis</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># multigen_fig</span>
<span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_vec</span><span class="p">,</span> <span class="n">colony_series</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkslategray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">time_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;colony volume (fL)&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">save_fig_to_dir</span><span class="p">(</span><span class="n">multigen_fig</span><span class="p">,</span> <span class="s1">&#39;growth_division_output.pdf&#39;</span><span class="p">)</span>
<span class="n">multigen_fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing out/growth_division_output.pdf
</pre></div>
</div>
<img alt="../../_images/Vivarium_interface_basics_73_1.png" src="../../_images/Vivarium_interface_basics_73_1.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./software_and_tools/vivarium"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Vivarium_intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Vivarium</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Helen Scott<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>